<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<title>wowzer - Best item prices</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
<script type="text/javascript">

function gup(name)
{
  name = name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
  var regexS = "[\\?&]"+name+"=([^&#]*)";
  var regex = new RegExp( regexS );
  var results = regex.exec( window.location.href );
  if( results == null )
    return "";
  else
    return results[1];
}

function wowprice(o) {
    var pricecopper = function(c) {
        var g = Math.floor(c/10000);
        var s = Math.floor((c%10000) / 100);
        c = c - s*100 - g*10000;
        var ret = '';
        return g+'g '+s+'s '+c+'c';
    }

    if (typeof(o) == "number")
        return pricecopper(o);
    else {
        var ret = [];
        $.each(o, function() {
            ret.push(pricecopper(this)); 
        });
        return ret;
    }
}

$(function(){
    var realm = gup("name");
    var country = gup("country");
    if (realm == "" || country == "") {
        $('#loading').hide();    
        $('#invalid').show();
    }
    else {
        $.ajax({
            url: 'realms/'+country+'/'+realm+'/arb_a',
            success: function(data){
                data = data.sort(function(a, b) {
                    return (b['profit'] - a['profit']);
                });

                var wraprow = function(row) {
                    var s='<tr>';
                    $.each(row, function() {
                        s+='<td>'+this+'</td>';
                    });
                    s += '</tr>';
                    return s;
                }
                
                $.each(data, function(){
                    $('#table tr:last').before(
                        wraprow([this['item'],
                                wowprice(this['profit']),
                                wowprice(this['buy']).join(','),
                                wowprice(this['sell']),
                                this['reagents'].join(',')])
                );
                });

                $('#loading').hide();
                $('#heading').html('Stats for ' + realm);
                $('#main').show();
            },
            dataType: 'json'
        });
    }

});

</script>
<link rel="stylesheet" href="main.css" type="text/css" /> 
</head>
<body>

<div class="centered">
    <div id="main" style="display:none;">
        <h1 id="heading"></h1>
        <table cellpadding="0" cellspacing="0" border="1" class="display" id="table">
              <thead>
                    <tr>
                            <th>Item</th>
                            <th>Profit</th>
                            <th>Buy</th>
                            <th>Sell</th>
                            <th>Mats</th>
                    <tr>
            <thead>

            <tbody>
            </tbody> 
        </table>
    </div>
    <div id="invalid" style="display:none;">
        <h1>
        Please choose a realm.
        </h1>
    </div>
    <div id="loading">
        <h1 id="heading">
        Loading realm stats...
        </h1>
    </div>
</div>

</body>
</html>
